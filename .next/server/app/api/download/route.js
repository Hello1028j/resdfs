"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/download/route";
exports.ids = ["app/api/download/route"];
exports.modules = {

/***/ "@distube/ytdl-core":
/*!*************************************!*\
  !*** external "@distube/ytdl-core" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("@distube/ytdl-core");

/***/ }),

/***/ "fs-extra":
/*!***************************!*\
  !*** external "fs-extra" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("fs-extra");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdownload%2Froute&page=%2Fapi%2Fdownload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdownload%2Froute.ts&appDir=%2FUsers%2FAdamm%2FDownloads%2Fvid2%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2FAdamm%2FDownloads%2Fvid2&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdownload%2Froute&page=%2Fapi%2Fdownload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdownload%2Froute.ts&appDir=%2FUsers%2FAdamm%2FDownloads%2Fvid2%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2FAdamm%2FDownloads%2Fvid2&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_Adamm_Downloads_vid2_app_api_download_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/download/route.ts */ \"(rsc)/./app/api/download/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/download/route\",\n        pathname: \"/api/download\",\n        filename: \"route\",\n        bundlePath: \"app/api/download/route\"\n    },\n    resolvedPagePath: \"/Users/Adamm/Downloads/vid2/app/api/download/route.ts\",\n    nextConfigOutput,\n    userland: _Users_Adamm_Downloads_vid2_app_api_download_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/download/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZkb3dubG9hZCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGZG93bmxvYWQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZkb3dubG9hZCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRkFkYW1tJTJGRG93bmxvYWRzJTJGdmlkMiUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZBZGFtbSUyRkRvd25sb2FkcyUyRnZpZDImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDSztBQUNsRjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHVHQUF1RztBQUMvRztBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzZKOztBQUU3SiIsInNvdXJjZXMiOlsid2VicGFjazovL3lvdXR1YmUtZG93bmxvYWRlci8/ZDlhYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvQWRhbW0vRG93bmxvYWRzL3ZpZDIvYXBwL2FwaS9kb3dubG9hZC9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZG93bmxvYWQvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9kb3dubG9hZFwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvZG93bmxvYWQvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvQWRhbW0vRG93bmxvYWRzL3ZpZDIvYXBwL2FwaS9kb3dubG9hZC9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9kb3dubG9hZC9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdownload%2Froute&page=%2Fapi%2Fdownload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdownload%2Froute.ts&appDir=%2FUsers%2FAdamm%2FDownloads%2Fvid2%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2FAdamm%2FDownloads%2Fvid2&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/download/route.ts":
/*!***********************************!*\
  !*** ./app/api/download/route.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _distube_ytdl_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @distube/ytdl-core */ \"@distube/ytdl-core\");\n/* harmony import */ var _distube_ytdl_core__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_distube_ytdl_core__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var fs_extra__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs-extra */ \"fs-extra\");\n/* harmony import */ var fs_extra__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs_extra__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! util */ \"util\");\n/* harmony import */ var util__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(util__WEBPACK_IMPORTED_MODULE_4__);\n\n\n\n\n\nconst writeFile = (0,util__WEBPACK_IMPORTED_MODULE_4__.promisify)((fs_extra__WEBPACK_IMPORTED_MODULE_2___default().writeFile));\nconst unlink = (0,util__WEBPACK_IMPORTED_MODULE_4__.promisify)((fs_extra__WEBPACK_IMPORTED_MODULE_2___default().unlink));\n// Helper function to format file size\nfunction formatFileSize(bytes) {\n    if (bytes === 0) return \"0 Bytes\";\n    const k = 1024;\n    const sizes = [\n        \"Bytes\",\n        \"KB\",\n        \"MB\",\n        \"GB\"\n    ];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + \" \" + sizes[i];\n}\nfunction isTiktokUrl(url) {\n    return /tiktok\\.com\\//i.test(url) || /vm\\.tiktok\\.com\\//i.test(url);\n}\nasync function POST(request) {\n    try {\n        const { url, format } = await request.json();\n        if (!url || !format) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"URL and format are required\"\n            }, {\n                status: 400\n            });\n        }\n        if (isTiktokUrl(url)) {\n            if (format !== \"mp4\") {\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                    error: \"Only MP4 download is supported for TikTok.\"\n                }, {\n                    status: 400\n                });\n            }\n            try {\n                // Use tikwm.com API to get download link\n                const apiUrl = `https://tikwm.com/api/?url=${encodeURIComponent(url)}`;\n                const res = await fetch(apiUrl);\n                const data = await res.json();\n                if (data.code !== 0 || !data.data) {\n                    return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                        error: data.msg || \"Failed to fetch TikTok video\"\n                    }, {\n                        status: 400\n                    });\n                }\n                const info = data.data;\n                const videoUrl = info.play || info.url || info.wmplay || info.hdplay;\n                if (!videoUrl) {\n                    return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                        error: \"No downloadable video found.\"\n                    }, {\n                        status: 400\n                    });\n                }\n                // Download the TikTok video to a buffer\n                const response = await fetch(videoUrl);\n                if (!response.ok) {\n                    return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                        error: \"Failed to fetch TikTok video file.\"\n                    }, {\n                        status: 500\n                    });\n                }\n                const fileBuffer = Buffer.from(await response.arrayBuffer());\n                const fileSize = fileBuffer.length;\n                const formattedSize = formatFileSize(fileSize);\n                const videoTitle = (info.title || \"tiktok-video\").replace(/[^\\w\\s-]/g, \"\");\n                return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](fileBuffer, {\n                    status: 200,\n                    headers: {\n                        \"Content-Type\": \"video/mp4\",\n                        \"Content-Disposition\": `attachment; filename=\"${videoTitle}.mp4\"`,\n                        \"Content-Length\": fileSize.toString(),\n                        \"X-File-Size\": formattedSize,\n                        \"Cache-Control\": \"no-cache\"\n                    }\n                });\n            } catch (err) {\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                    error: \"Failed to download TikTok video\"\n                }, {\n                    status: 500\n                });\n            }\n        }\n        if (!_distube_ytdl_core__WEBPACK_IMPORTED_MODULE_1___default().validateURL(url)) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Invalid YouTube URL\"\n            }, {\n                status: 400\n            });\n        }\n        console.log(\"Starting download for:\", url, \"format:\", format);\n        // Get video info\n        const info = await _distube_ytdl_core__WEBPACK_IMPORTED_MODULE_1___default().getInfo(url);\n        const videoTitle = info.videoDetails.title.replace(/[^\\w\\s-]/g, \"\");\n        const videoId = info.videoDetails.videoId;\n        console.log(\"Video title:\", videoTitle);\n        // Create temp directory\n        const tempDir = path__WEBPACK_IMPORTED_MODULE_3___default().join(process.cwd(), \"temp\");\n        await fs_extra__WEBPACK_IMPORTED_MODULE_2___default().ensureDir(tempDir);\n        if (format === \"mp4\") {\n            // Download as MP4\n            const videoPath = path__WEBPACK_IMPORTED_MODULE_3___default().join(tempDir, `${videoTitle}.mp4`);\n            const videoStream = _distube_ytdl_core__WEBPACK_IMPORTED_MODULE_1___default()(url, {\n                quality: \"highest\",\n                filter: \"audioandvideo\"\n            });\n            const writeStream = fs_extra__WEBPACK_IMPORTED_MODULE_2___default().createWriteStream(videoPath);\n            return new Promise((resolve, reject)=>{\n                let downloadedBytes = 0;\n                let startTime = Date.now();\n                videoStream.on(\"progress\", (chunkLength, downloaded, total)=>{\n                    downloadedBytes = downloaded;\n                    const percentage = Math.round(downloaded / total * 100);\n                    const downloadedMB = (downloaded / (1024 * 1024)).toFixed(1);\n                    const totalMB = (total / (1024 * 1024)).toFixed(1);\n                    const elapsed = (Date.now() - startTime) / 1000;\n                    const speed = elapsed > 0 ? (downloaded / (1024 * 1024) / elapsed).toFixed(1) : \"0\";\n                    console.log(`Progress: ${percentage}% - ${downloadedMB}MB/${totalMB}MB - ${speed}MB/s`);\n                });\n                videoStream.pipe(writeStream);\n                writeStream.on(\"finish\", async ()=>{\n                    try {\n                        console.log(\"Video download completed, reading file...\");\n                        const fileBuffer = await fs_extra__WEBPACK_IMPORTED_MODULE_2___default().readFile(videoPath);\n                        await unlink(videoPath) // Clean up temp file\n                        ;\n                        const fileSize = fileBuffer.length;\n                        const formattedSize = formatFileSize(fileSize);\n                        console.log(\"Sending video response, size:\", formattedSize);\n                        const response = new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](fileBuffer, {\n                            status: 200,\n                            headers: {\n                                \"Content-Type\": \"video/mp4\",\n                                \"Content-Disposition\": `attachment; filename=\"${videoTitle}.mp4\"`,\n                                \"Content-Length\": fileSize.toString(),\n                                \"X-File-Size\": formattedSize,\n                                \"Cache-Control\": \"no-cache\"\n                            }\n                        });\n                        resolve(response);\n                    } catch (error) {\n                        console.error(\"Error processing video:\", error);\n                        reject(next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                            error: \"Failed to process video\"\n                        }, {\n                            status: 500\n                        }));\n                    }\n                });\n                writeStream.on(\"error\", (error)=>{\n                    console.error(\"Error writing video file:\", error);\n                    reject(next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                        error: \"Failed to download video\"\n                    }, {\n                        status: 500\n                    }));\n                });\n            });\n        } else if (format === \"mp3\") {\n            // Download as MP3 (audio only)\n            const audioPath = path__WEBPACK_IMPORTED_MODULE_3___default().join(tempDir, `${videoTitle}.mp3`);\n            const audioStream = _distube_ytdl_core__WEBPACK_IMPORTED_MODULE_1___default()(url, {\n                quality: \"highestaudio\",\n                filter: \"audioonly\"\n            });\n            const writeStream = fs_extra__WEBPACK_IMPORTED_MODULE_2___default().createWriteStream(audioPath);\n            return new Promise((resolve, reject)=>{\n                let downloadedBytes = 0;\n                let startTime = Date.now();\n                audioStream.on(\"progress\", (chunkLength, downloaded, total)=>{\n                    downloadedBytes = downloaded;\n                    const percentage = Math.round(downloaded / total * 100);\n                    const downloadedMB = (downloaded / (1024 * 1024)).toFixed(1);\n                    const totalMB = (total / (1024 * 1024)).toFixed(1);\n                    const elapsed = (Date.now() - startTime) / 1000;\n                    const speed = elapsed > 0 ? (downloaded / (1024 * 1024) / elapsed).toFixed(1) : \"0\";\n                    console.log(`Progress: ${percentage}% - ${downloadedMB}MB/${totalMB}MB - ${speed}MB/s`);\n                });\n                audioStream.pipe(writeStream);\n                writeStream.on(\"finish\", async ()=>{\n                    try {\n                        console.log(\"Audio download completed\");\n                        const fileBuffer = await fs_extra__WEBPACK_IMPORTED_MODULE_2___default().readFile(audioPath);\n                        await unlink(audioPath) // Clean up temp file\n                        ;\n                        const fileSize = fileBuffer.length;\n                        const formattedSize = formatFileSize(fileSize);\n                        console.log(\"Sending audio response, size:\", formattedSize);\n                        const response = new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](fileBuffer, {\n                            status: 200,\n                            headers: {\n                                \"Content-Type\": \"audio/mpeg\",\n                                \"Content-Disposition\": `attachment; filename=\"${videoTitle}.mp3\"`,\n                                \"Content-Length\": fileSize.toString(),\n                                \"X-File-Size\": formattedSize,\n                                \"Cache-Control\": \"no-cache\"\n                            }\n                        });\n                        resolve(response);\n                    } catch (error) {\n                        console.error(\"Error processing audio:\", error);\n                        reject(next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                            error: \"Failed to process audio\"\n                        }, {\n                            status: 500\n                        }));\n                    }\n                });\n                writeStream.on(\"error\", (error)=>{\n                    console.error(\"Error writing audio file:\", error);\n                    reject(next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                        error: \"Failed to download audio\"\n                    }, {\n                        status: 500\n                    }));\n                });\n            });\n        } else {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: 'Invalid format. Use \"mp4\" or \"mp3\"'\n            }, {\n                status: 400\n            });\n        }\n    } catch (error) {\n        console.error(\"Download error:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SSxDQUN0Qjs0QkFBRUMsT0FBTzt3QkFBMEIsR0FDbkM7NEJBQUVDLFFBQVE7d0JBQUk7b0JBRWxCO2dCQUNGO2dCQUVBMEMsWUFBWVMsRUFBRSxDQUFDLFNBQVMsQ0FBQ3BEO29CQUN2QjhCLFFBQVE5QixLQUFLLENBQUMsNkJBQTZCQTtvQkFDM0MrQyxPQUFPeEUsa0ZBQVlBLENBQUN3QixJQUFJLENBQ3RCO3dCQUFFQyxPQUFPO29CQUEyQixHQUNwQzt3QkFBRUMsUUFBUTtvQkFBSTtnQkFFbEI7WUFDRjtRQUNGLE9BQU87WUFDTCxPQUFPMUIsa0ZBQVlBLENBQUN3QixJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQXFDLEdBQzlDO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7SUFDRixFQUFFLE9BQU9ELE9BQU87UUFDZDhCLFFBQVE5QixLQUFLLENBQUMsbUJBQW1CQTtRQUNqQyxPQUFPekIsa0ZBQVlBLENBQUN3QixJQUFJLENBQ3RCO1lBQUVDLE9BQU87UUFBd0IsR0FDakM7WUFBRUMsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95b3V0dWJlLWRvd25sb2FkZXIvLi9hcHAvYXBpL2Rvd25sb2FkL3JvdXRlLnRzPzQ0ZDYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHl0ZGwgZnJvbSAnQGRpc3R1YmUveXRkbC1jb3JlJ1xuaW1wb3J0IGZzIGZyb20gJ2ZzLWV4dHJhJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gJ3V0aWwnXG5cbmNvbnN0IHdyaXRlRmlsZSA9IHByb21pc2lmeShmcy53cml0ZUZpbGUpXG5jb25zdCB1bmxpbmsgPSBwcm9taXNpZnkoZnMudW5saW5rKVxuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gZm9ybWF0IGZpbGUgc2l6ZVxuZnVuY3Rpb24gZm9ybWF0RmlsZVNpemUoYnl0ZXM6IG51bWJlcik6IHN0cmluZyB7XG4gIGlmIChieXRlcyA9PT0gMCkgcmV0dXJuICcwIEJ5dGVzJ1xuICBjb25zdCBrID0gMTAyNFxuICBjb25zdCBzaXplcyA9IFsnQnl0ZXMnLCAnS0InLCAnTUInLCAnR0InXVxuICBjb25zdCBpID0gTWF0aC5mbG9vcihNYXRoLmxvZyhieXRlcykgLyBNYXRoLmxvZyhrKSlcbiAgcmV0dXJuIHBhcnNlRmxvYXQoKGJ5dGVzIC8gTWF0aC5wb3coaywgaSkpLnRvRml4ZWQoMikpICsgJyAnICsgc2l6ZXNbaV1cbn1cblxuZnVuY3Rpb24gaXNUaWt0b2tVcmwodXJsOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIC90aWt0b2tcXC5jb21cXC8vaS50ZXN0KHVybCkgfHwgL3ZtXFwudGlrdG9rXFwuY29tXFwvL2kudGVzdCh1cmwpXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyB1cmwsIGZvcm1hdCB9ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcblxuICAgIGlmICghdXJsIHx8ICFmb3JtYXQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ1VSTCBhbmQgZm9ybWF0IGFyZSByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgaWYgKGlzVGlrdG9rVXJsKHVybCkpIHtcbiAgICAgIGlmIChmb3JtYXQgIT09ICdtcDQnKSB7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICB7IGVycm9yOiAnT25seSBNUDQgZG93bmxvYWQgaXMgc3VwcG9ydGVkIGZvciBUaWtUb2suJyB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICApXG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICAvLyBVc2UgdGlrd20uY29tIEFQSSB0byBnZXQgZG93bmxvYWQgbGlua1xuICAgICAgICBjb25zdCBhcGlVcmwgPSBgaHR0cHM6Ly90aWt3bS5jb20vYXBpLz91cmw9JHtlbmNvZGVVUklDb21wb25lbnQodXJsKX1gXG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGFwaVVybClcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcy5qc29uKClcbiAgICAgICAgaWYgKGRhdGEuY29kZSAhPT0gMCB8fCAhZGF0YS5kYXRhKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgeyBlcnJvcjogZGF0YS5tc2cgfHwgJ0ZhaWxlZCB0byBmZXRjaCBUaWtUb2sgdmlkZW8nIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgICApXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW5mbyA9IGRhdGEuZGF0YVxuICAgICAgICBjb25zdCB2aWRlb1VybCA9IGluZm8ucGxheSB8fCBpbmZvLnVybCB8fCBpbmZvLndtcGxheSB8fCBpbmZvLmhkcGxheVxuICAgICAgICBpZiAoIXZpZGVvVXJsKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgeyBlcnJvcjogJ05vIGRvd25sb2FkYWJsZSB2aWRlbyBmb3VuZC4nIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgICApXG4gICAgICAgIH1cbiAgICAgICAgLy8gRG93bmxvYWQgdGhlIFRpa1RvayB2aWRlbyB0byBhIGJ1ZmZlclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHZpZGVvVXJsKVxuICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCBUaWtUb2sgdmlkZW8gZmlsZS4nIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICAgICApXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZmlsZUJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGF3YWl0IHJlc3BvbnNlLmFycmF5QnVmZmVyKCkpXG4gICAgICAgIGNvbnN0IGZpbGVTaXplID0gZmlsZUJ1ZmZlci5sZW5ndGhcbiAgICAgICAgY29uc3QgZm9ybWF0dGVkU2l6ZSA9IGZvcm1hdEZpbGVTaXplKGZpbGVTaXplKVxuICAgICAgICBjb25zdCB2aWRlb1RpdGxlID0gKGluZm8udGl0bGUgfHwgJ3Rpa3Rvay12aWRlbycpLnJlcGxhY2UoL1teXFx3XFxzLV0vZywgJycpXG4gICAgICAgIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKGZpbGVCdWZmZXIsIHtcbiAgICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ3ZpZGVvL21wNCcsXG4gICAgICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbic6IGBhdHRhY2htZW50OyBmaWxlbmFtZT1cIiR7dmlkZW9UaXRsZX0ubXA0XCJgLFxuICAgICAgICAgICAgJ0NvbnRlbnQtTGVuZ3RoJzogZmlsZVNpemUudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICdYLUZpbGUtU2l6ZSc6IGZvcm1hdHRlZFNpemUsXG4gICAgICAgICAgICAnQ2FjaGUtQ29udHJvbCc6ICduby1jYWNoZSdcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9IGNhdGNoIChlcnI6IHVua25vd24pIHtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gZG93bmxvYWQgVGlrVG9rIHZpZGVvJyB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgICApXG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCF5dGRsLnZhbGlkYXRlVVJMKHVybCkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogJ0ludmFsaWQgWW91VHViZSBVUkwnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCdTdGFydGluZyBkb3dubG9hZCBmb3I6JywgdXJsLCAnZm9ybWF0OicsIGZvcm1hdClcblxuICAgIC8vIEdldCB2aWRlbyBpbmZvXG4gICAgY29uc3QgaW5mbyA9IGF3YWl0IHl0ZGwuZ2V0SW5mbyh1cmwpXG4gICAgY29uc3QgdmlkZW9UaXRsZSA9IGluZm8udmlkZW9EZXRhaWxzLnRpdGxlLnJlcGxhY2UoL1teXFx3XFxzLV0vZywgJycpXG4gICAgY29uc3QgdmlkZW9JZCA9IGluZm8udmlkZW9EZXRhaWxzLnZpZGVvSWRcblxuICAgIGNvbnNvbGUubG9nKCdWaWRlbyB0aXRsZTonLCB2aWRlb1RpdGxlKVxuXG4gICAgLy8gQ3JlYXRlIHRlbXAgZGlyZWN0b3J5XG4gICAgY29uc3QgdGVtcERpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAndGVtcCcpXG4gICAgYXdhaXQgZnMuZW5zdXJlRGlyKHRlbXBEaXIpXG5cbiAgICBpZiAoZm9ybWF0ID09PSAnbXA0Jykge1xuICAgICAgLy8gRG93bmxvYWQgYXMgTVA0XG4gICAgICBjb25zdCB2aWRlb1BhdGggPSBwYXRoLmpvaW4odGVtcERpciwgYCR7dmlkZW9UaXRsZX0ubXA0YClcbiAgICAgIFxuICAgICAgY29uc3QgdmlkZW9TdHJlYW0gPSB5dGRsKHVybCwge1xuICAgICAgICBxdWFsaXR5OiAnaGlnaGVzdCcsXG4gICAgICAgIGZpbHRlcjogJ2F1ZGlvYW5kdmlkZW8nXG4gICAgICB9KVxuXG4gICAgICBjb25zdCB3cml0ZVN0cmVhbSA9IGZzLmNyZWF0ZVdyaXRlU3RyZWFtKHZpZGVvUGF0aClcbiAgICAgIFxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgbGV0IGRvd25sb2FkZWRCeXRlcyA9IDBcbiAgICAgICAgbGV0IHN0YXJ0VGltZSA9IERhdGUubm93KClcbiAgICAgICAgXG4gICAgICAgIHZpZGVvU3RyZWFtLm9uKCdwcm9ncmVzcycsIChjaHVua0xlbmd0aCwgZG93bmxvYWRlZCwgdG90YWwpID0+IHtcbiAgICAgICAgICBkb3dubG9hZGVkQnl0ZXMgPSBkb3dubG9hZGVkXG4gICAgICAgICAgY29uc3QgcGVyY2VudGFnZSA9IE1hdGgucm91bmQoKGRvd25sb2FkZWQgLyB0b3RhbCkgKiAxMDApXG4gICAgICAgICAgY29uc3QgZG93bmxvYWRlZE1CID0gKGRvd25sb2FkZWQgLyAoMTAyNCAqIDEwMjQpKS50b0ZpeGVkKDEpXG4gICAgICAgICAgY29uc3QgdG90YWxNQiA9ICh0b3RhbCAvICgxMDI0ICogMTAyNCkpLnRvRml4ZWQoMSlcbiAgICAgICAgICBjb25zdCBlbGFwc2VkID0gKERhdGUubm93KCkgLSBzdGFydFRpbWUpIC8gMTAwMFxuICAgICAgICAgIGNvbnN0IHNwZWVkID0gZWxhcHNlZCA+IDAgPyAoZG93bmxvYWRlZCAvICgxMDI0ICogMTAyNCkgLyBlbGFwc2VkKS50b0ZpeGVkKDEpIDogJzAnXG4gICAgICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coYFByb2dyZXNzOiAke3BlcmNlbnRhZ2V9JSAtICR7ZG93bmxvYWRlZE1CfU1CLyR7dG90YWxNQn1NQiAtICR7c3BlZWR9TUIvc2ApXG4gICAgICAgIH0pXG5cbiAgICAgICAgdmlkZW9TdHJlYW0ucGlwZSh3cml0ZVN0cmVhbSlcbiAgICAgICAgXG4gICAgICAgIHdyaXRlU3RyZWFtLm9uKCdmaW5pc2gnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdWaWRlbyBkb3dubG9hZCBjb21wbGV0ZWQsIHJlYWRpbmcgZmlsZS4uLicpXG4gICAgICAgICAgICBjb25zdCBmaWxlQnVmZmVyID0gYXdhaXQgZnMucmVhZEZpbGUodmlkZW9QYXRoKVxuICAgICAgICAgICAgYXdhaXQgdW5saW5rKHZpZGVvUGF0aCkgLy8gQ2xlYW4gdXAgdGVtcCBmaWxlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGZpbGVTaXplID0gZmlsZUJ1ZmZlci5sZW5ndGhcbiAgICAgICAgICAgIGNvbnN0IGZvcm1hdHRlZFNpemUgPSBmb3JtYXRGaWxlU2l6ZShmaWxlU2l6ZSlcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc29sZS5sb2coJ1NlbmRpbmcgdmlkZW8gcmVzcG9uc2UsIHNpemU6JywgZm9ybWF0dGVkU2l6ZSlcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBuZXcgTmV4dFJlc3BvbnNlKGZpbGVCdWZmZXIsIHtcbiAgICAgICAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ3ZpZGVvL21wNCcsXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtRGlzcG9zaXRpb24nOiBgYXR0YWNobWVudDsgZmlsZW5hbWU9XCIke3ZpZGVvVGl0bGV9Lm1wNFwiYCxcbiAgICAgICAgICAgICAgICAnQ29udGVudC1MZW5ndGgnOiBmaWxlU2l6ZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICdYLUZpbGUtU2l6ZSc6IGZvcm1hdHRlZFNpemUsXG4gICAgICAgICAgICAgICAgJ0NhY2hlLUNvbnRyb2wnOiAnbm8tY2FjaGUnXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpXG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHByb2Nlc3NpbmcgdmlkZW86JywgZXJyb3IpXG4gICAgICAgICAgICByZWplY3QoTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gcHJvY2VzcyB2aWRlbycgfSxcbiAgICAgICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICAgICAgICApKVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgXG4gICAgICAgIHdyaXRlU3RyZWFtLm9uKCdlcnJvcicsIChlcnJvcikgPT4ge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHdyaXRpbmcgdmlkZW8gZmlsZTonLCBlcnJvcilcbiAgICAgICAgICByZWplY3QoTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIGRvd25sb2FkIHZpZGVvJyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICAgICAgKSlcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSBlbHNlIGlmIChmb3JtYXQgPT09ICdtcDMnKSB7XG4gICAgICAvLyBEb3dubG9hZCBhcyBNUDMgKGF1ZGlvIG9ubHkpXG4gICAgICBjb25zdCBhdWRpb1BhdGggPSBwYXRoLmpvaW4odGVtcERpciwgYCR7dmlkZW9UaXRsZX0ubXAzYClcbiAgICAgIFxuICAgICAgY29uc3QgYXVkaW9TdHJlYW0gPSB5dGRsKHVybCwge1xuICAgICAgICBxdWFsaXR5OiAnaGlnaGVzdGF1ZGlvJyxcbiAgICAgICAgZmlsdGVyOiAnYXVkaW9vbmx5J1xuICAgICAgfSlcblxuICAgICAgY29uc3Qgd3JpdGVTdHJlYW0gPSBmcy5jcmVhdGVXcml0ZVN0cmVhbShhdWRpb1BhdGgpXG4gICAgICBcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGxldCBkb3dubG9hZGVkQnl0ZXMgPSAwXG4gICAgICAgIGxldCBzdGFydFRpbWUgPSBEYXRlLm5vdygpXG4gICAgICAgIFxuICAgICAgICBhdWRpb1N0cmVhbS5vbigncHJvZ3Jlc3MnLCAoY2h1bmtMZW5ndGgsIGRvd25sb2FkZWQsIHRvdGFsKSA9PiB7XG4gICAgICAgICAgZG93bmxvYWRlZEJ5dGVzID0gZG93bmxvYWRlZFxuICAgICAgICAgIGNvbnN0IHBlcmNlbnRhZ2UgPSBNYXRoLnJvdW5kKChkb3dubG9hZGVkIC8gdG90YWwpICogMTAwKVxuICAgICAgICAgIGNvbnN0IGRvd25sb2FkZWRNQiA9IChkb3dubG9hZGVkIC8gKDEwMjQgKiAxMDI0KSkudG9GaXhlZCgxKVxuICAgICAgICAgIGNvbnN0IHRvdGFsTUIgPSAodG90YWwgLyAoMTAyNCAqIDEwMjQpKS50b0ZpeGVkKDEpXG4gICAgICAgICAgY29uc3QgZWxhcHNlZCA9IChEYXRlLm5vdygpIC0gc3RhcnRUaW1lKSAvIDEwMDBcbiAgICAgICAgICBjb25zdCBzcGVlZCA9IGVsYXBzZWQgPiAwID8gKGRvd25sb2FkZWQgLyAoMTAyNCAqIDEwMjQpIC8gZWxhcHNlZCkudG9GaXhlZCgxKSA6ICcwJ1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKGBQcm9ncmVzczogJHtwZXJjZW50YWdlfSUgLSAke2Rvd25sb2FkZWRNQn1NQi8ke3RvdGFsTUJ9TUIgLSAke3NwZWVkfU1CL3NgKVxuICAgICAgICB9KVxuXG4gICAgICAgIGF1ZGlvU3RyZWFtLnBpcGUod3JpdGVTdHJlYW0pXG4gICAgICAgIFxuICAgICAgICB3cml0ZVN0cmVhbS5vbignZmluaXNoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQXVkaW8gZG93bmxvYWQgY29tcGxldGVkJylcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgZmlsZUJ1ZmZlciA9IGF3YWl0IGZzLnJlYWRGaWxlKGF1ZGlvUGF0aClcbiAgICAgICAgICAgIGF3YWl0IHVubGluayhhdWRpb1BhdGgpIC8vIENsZWFuIHVwIHRlbXAgZmlsZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBmaWxlU2l6ZSA9IGZpbGVCdWZmZXIubGVuZ3RoXG4gICAgICAgICAgICBjb25zdCBmb3JtYXR0ZWRTaXplID0gZm9ybWF0RmlsZVNpemUoZmlsZVNpemUpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTZW5kaW5nIGF1ZGlvIHJlc3BvbnNlLCBzaXplOicsIGZvcm1hdHRlZFNpemUpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gbmV3IE5leHRSZXNwb25zZShmaWxlQnVmZmVyLCB7XG4gICAgICAgICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhdWRpby9tcGVnJyxcbiAgICAgICAgICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbic6IGBhdHRhY2htZW50OyBmaWxlbmFtZT1cIiR7dmlkZW9UaXRsZX0ubXAzXCJgLFxuICAgICAgICAgICAgICAgICdDb250ZW50LUxlbmd0aCc6IGZpbGVTaXplLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgJ1gtRmlsZS1TaXplJzogZm9ybWF0dGVkU2l6ZSxcbiAgICAgICAgICAgICAgICAnQ2FjaGUtQ29udHJvbCc6ICduby1jYWNoZSdcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSlcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcHJvY2Vzc2luZyBhdWRpbzonLCBlcnJvcilcbiAgICAgICAgICAgIHJlamVjdChOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byBwcm9jZXNzIGF1ZGlvJyB9LFxuICAgICAgICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICAgICAgICkpXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICBcbiAgICAgICAgd3JpdGVTdHJlYW0ub24oJ2Vycm9yJywgKGVycm9yKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igd3JpdGluZyBhdWRpbyBmaWxlOicsIGVycm9yKVxuICAgICAgICAgIHJlamVjdChOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gZG93bmxvYWQgYXVkaW8nIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICAgICApKVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnSW52YWxpZCBmb3JtYXQuIFVzZSBcIm1wNFwiIG9yIFwibXAzXCInIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdEb3dubG9hZCBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59ICJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJ5dGRsIiwiZnMiLCJwYXRoIiwicHJvbWlzaWZ5Iiwid3JpdGVGaWxlIiwidW5saW5rIiwiZm9ybWF0RmlsZVNpemUiLCJieXRlcyIsImsiLCJzaXplcyIsImkiLCJNYXRoIiwiZmxvb3IiLCJsb2ciLCJwYXJzZUZsb2F0IiwicG93IiwidG9GaXhlZCIsImlzVGlrdG9rVXJsIiwidXJsIiwidGVzdCIsIlBPU1QiLCJyZXF1ZXN0IiwiZm9ybWF0IiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiYXBpVXJsIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwicmVzIiwiZmV0Y2giLCJkYXRhIiwiY29kZSIsIm1zZyIsImluZm8iLCJ2aWRlb1VybCIsInBsYXkiLCJ3bXBsYXkiLCJoZHBsYXkiLCJyZXNwb25zZSIsIm9rIiwiZmlsZUJ1ZmZlciIsIkJ1ZmZlciIsImZyb20iLCJhcnJheUJ1ZmZlciIsImZpbGVTaXplIiwibGVuZ3RoIiwiZm9ybWF0dGVkU2l6ZSIsInZpZGVvVGl0bGUiLCJ0aXRsZSIsInJlcGxhY2UiLCJoZWFkZXJzIiwidG9TdHJpbmciLCJlcnIiLCJ2YWxpZGF0ZVVSTCIsImNvbnNvbGUiLCJnZXRJbmZvIiwidmlkZW9EZXRhaWxzIiwidmlkZW9JZCIsInRlbXBEaXIiLCJqb2luIiwicHJvY2VzcyIsImN3ZCIsImVuc3VyZURpciIsInZpZGVvUGF0aCIsInZpZGVvU3RyZWFtIiwicXVhbGl0eSIsImZpbHRlciIsIndyaXRlU3RyZWFtIiwiY3JlYXRlV3JpdGVTdHJlYW0iLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImRvd25sb2FkZWRCeXRlcyIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJvbiIsImNodW5rTGVuZ3RoIiwiZG93bmxvYWRlZCIsInRvdGFsIiwicGVyY2VudGFnZSIsInJvdW5kIiwiZG93bmxvYWRlZE1CIiwidG90YWxNQiIsImVsYXBzZWQiLCJzcGVlZCIsInBpcGUiLCJyZWFkRmlsZSIsImF1ZGlvUGF0aCIsImF1ZGlvU3RyZWFtIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/download/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdownload%2Froute&page=%2Fapi%2Fdownload%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdownload%2Froute.ts&appDir=%2FUsers%2FAdamm%2FDownloads%2Fvid2%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2FAdamm%2FDownloads%2Fvid2&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();